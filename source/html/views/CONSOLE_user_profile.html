<?dbax dbax_core.include('header'); ?>
<?dbax  
    dbax_core.g$view('page_head') := '        
    <!-- SweetAlert 2-->     
    <link href="${resources_url}/plugins/sweetalert2/sweetalert2.css" rel="stylesheet" type="text/css" />
  	<!-- iCheck for checkboxes and radio inputs -->
  	<link rel="stylesheet" href="${resources_url}/plugins/iCheck/all.css">
    ';
?>    

<!-- SideBar -->
<?dbax dbax_core.include('sidebar');?> 

   
<div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <h1>
        User Profile
      </h1>
       <ol class="breadcrumb">
		 <li><a href="${base_path}/index"><i class="fa fa-dashboard"></i> Home</a></li>       
         <li><a href="${base_path}/users"><i class="fa fa-users"></i> Users</a></li>
         <li>${profile_username}</li>
       </ol>          
    </section>

    <!-- Main content -->
    <section class="content">      
      <div class="row">
        <div class="col-md-3">

          <!-- Profile Image -->
          <div class="box box-primary">
            <div class="box-body box-profile">
              <!--<img class="profile-user-img img-responsive img-circle" src="${resources_url}/dist/img/avatar5.png" alt="User profile picture">-->
			  
              <h3 class="profile-username text-center">${profile_first_name} ${profile_last_name}</h3>

              <p class="text-muted text-center">${profile_display_name}</p>

              <ul class="list-group list-group-unbordered">
                <li class="list-group-item">
                  <b>Page views</b> <a class="pull-right">${profile_page_views}</a>
                </li>
                <li class="list-group-item">
                  <b>Active sessions</b> <a class="pull-right">${profile_active_sessions}</a>
                </li>
                <li class="list-group-item">
                  <b>Expired sessions</b> <a class="pull-right">${profile_expired_sessions}</a>
                </li>
              </ul>
              
              <?dbax 
               /*Obtener la IP del cliente*/
				/*declare
                    l_ip varchar2(300);
                begin
                  select sys_context( 'userenv', 'ip_address' ) into l_ip from dual;
                  p(l_ip);
                end;*/
			  ?>
              
              <!--<a href="#" class="btn btn-primary btn-block"><b>Follow</b></a>-->
            </div>
            <!-- /.box-body -->
          </div>
          <!-- /.box -->

        </div>
        <!-- /.col -->
        <div class="col-md-9">
          <div class="nav-tabs-custom">
            <ul class="nav nav-tabs">
              <li class="active"><a href="#settings" data-toggle="tab"><i class="fa fa-wrench"></i> Settings</a></li>
              <li><a href="#password" data-toggle="tab"><i class="fa fa-lock"></i> Password</a></li>
              <li><a href="#roles" data-toggle="tab"><i class="fa fa-user-secret"></i> Roles</a></li>
              <li><a href="#layoutOptions" data-toggle="tab"><i class="fa fa-gear"></i> Layout Options</a></li>
            </ul>
            <div class="tab-content">
              
              <div class="tab-pane active" id="settings">
                <!-- form start -->
                <form name="userSettingsForm" id="userSettingsForm" action="${base_path}/users/${profile_username}/update" class="form-horizontal" method="POST">                        

                  <div class="form-group">
                    <label for="profile_username" class="col-sm-2 control-label">Username</label>
                    <div class="col-sm-10">
                      <input type="text" class="form-control" name="profile_username" id="profile_username" value="${profile_username}" readonly="readonly">
                    </div>
                  </div>

                  <div class="form-group">
                    <label for="profile_first_name" class="col-sm-2 control-label">First Name</label>
                    <div class="col-sm-10">
                      <input type="text" class="form-control" name="profile_first_name" id="profile_first_name" value="${profile_first_name}">
                    </div>
                  </div>  

                  <div class="form-group">
                    <label for="profile_last_name" class="col-sm-2 control-label">Last Name</label>
                    <div class="col-sm-10">
                      <input type="text" class="form-control" name="profile_last_name" id="profile_last_name" value="${profile_last_name}">
                    </div>
                  </div>                         

                  <div class="form-group">
                    <label for="profile_display_name" class="col-sm-2 control-label">Display Name</label>
                    <div class="col-sm-10">
                      <input type="text" class="form-control" name="profile_display_name" id="profile_display_name" value="${profile_display_name}">
                    </div>
                  </div>                        

                   <div class="form-group">
                    <label for="profile_email" class="col-sm-2 control-label">Email</label>
                    <div class="col-sm-10">
                      <input type="email" class="form-control" name="profile_email" id="profile_email" value="${profile_email}">
                    </div>
                  </div>
                  
                  <div class="form-group">
                    <label for="profile_created_by" class="col-sm-2 control-label">Created By</label>
                    <div class="col-sm-10">
                      <input type="text" class="form-control" name="profile_created_by" id="profile_created_by" value="${profile_created_by}" readonly="readonly">
                    </div>
                  </div>

                  <div class="form-group">
                    <label for="profile_created_date" class="col-sm-2 control-label">Created Date</label>
                    <div class="col-sm-10">
                      <input type="text" class="form-control" name="profile_created_date" id="profile_created_date" value="${profile_created_date}" readonly="readonly">
                    </div>
                  </div>                          

                  <div class="form-group">
                    <label for="profile_modified_by" class="col-sm-2 control-label">Modified By</label>
                    <div class="col-sm-10">
                      <input type="text" class="form-control" name="profile_modified_by" id="profile_modified_by" value="${profile_modified_by}" readonly="readonly">
                    </div>
                  </div>                            

                  <div class="form-group">
                    <label for="profile_modified_date" class="col-sm-2 control-label">Modified Date</label>
                    <div class="col-sm-10">
                      <input type="text" class="form-control" name="profile_modified_date" id="profile_modified_date" value="${profile_modified_date}" readonly="readonly">
                    </div>
                  </div>                          

                  <input type="hidden" name="profile_hash" id="profile_hash" value="${profile_hash}">
                 </form>
                  
               <div class="row">
                 <div class="col-sm-offset-2 col-sm-10">
                   <button id="userSettingsBtn" class="btn btn-info" onclick="SubmitForm('userSettingsForm')"><i class="fa fa-save"></i> Save</button>
                 </div>
               </div>   

              </div><!-- /.tab-pane -->
            
            
            <div class="tab-pane" id="password">
            	 
              <?dbax
                IF '${alert_pwd}' = '1'
				THEN
                  p('<div class="alert alert-warning text-center">
                    <i class="icon fa fa-warning"></i> The user has been created from an authentication scheme.
					Change the password in the origin system
                  </div>');
				END IF;
			  ?>
              
              <!-- form start -->
                <form name="userPasswordForm" id="userPasswordForm" action="${base_path}/users/${profile_username}/change-password" class="form-horizontal" method="POST">                        

                  <div class="form-group">
                    <label for="old_password" class="col-sm-2 control-label"> Old Password</label>
                    <div class="col-sm-10">
                      <input type="password" class="form-control" name="old_password" id="old_password"  placeholder="Old password" required ${disabled}>
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="new_password" class="col-sm-2 control-label"> New Password</label>
                    <div class="col-sm-10">
                      <input type="password" class="form-control" name="new_password" id="new_password"  placeholder="New password" ${disabled}>
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="confirm_new_password" class="col-sm-2 control-label">Confirm New Password</label>
                    <div class="col-sm-10">
                      <input type="password" class="form-control" name="confirm_new_password" id="confirm_new_password"  placeholder="Confirm New Password" ${disabled}>
                    </div>
                  </div>                  				  
                </form>
              
               <div class="row">
                  <div class="col-sm-offset-2 col-sm-10">
                    <button id="userPasswordBtn" class="btn btn-danger" onclick="SubmitForm('userPasswordForm')" ${disabled}><i class="fa fa-check"></i> Change Password</button>
                  </div>
               </div>
              
            </div><!-- /.tab-pane -->
            <div class="tab-pane" id="roles">
            	<h4>Roles assigned to the user</h4>
              
			 	<table class="table table-bordered table-striped table-hover">
                  <thead>
                    <tr>
                    <th style="width: 10px">#</th>
                    <th>Role Name</th>
                    <th>Appid</th>
                    <th>Modified Date</th>                    
                  </tr>
                  </thead>
                  <tbody>
					 <?dbax
                      FOR c1 IN (SELECT a.*, rownum FROM TABLE (tapi_wdx_users_roles.tt('${profile_username}')) a )
                      LOOP
                        p('<tr>');
                          p('<td>'|| c1.rownum ||'.</td>');                        
                          p('<td>'|| c1.rolename||'</td>');                        
                          p('<td>'|| c1.appid ||'</td>');                        
                          p('<td>'|| to_char(c1.modified_date, 'YYYY/MM/DD hh24:mi:ss') ||'</td>');					    
                        p('</tr>');                      
                      END LOOP;
					 ?>
                </tbody>
              </table>              
            </div><!-- /.tab-pane -->
              
              
              
          <div class="tab-pane" id="layoutOptions">
              
            <ul class="list-group list-group-unbordered">
                <li class="list-group-item">
                  <label><input type="checkbox" id="togglesidebar" ${checkedToggleSidebar}> Toggle Sidebar</label>
                  <p class="help-block">Toggle the left sidebar's state (open or collapse)</p>
                 </li>
            </ul>            
            
          </div><!-- /.tab-pane -->    
              
              
              
              
            <!-- /.tab-content -->
          </div>
          <!-- /.nav-tabs-custom -->
        </div>
        <!-- /.col -->
      </div>
      <!-- /.row -->

    </section>
    <!-- /.content -->
  </div>

   
    <?dbax dbax_core.include('footer'); ?>

    <!-- SweetAlert 2 -->
    <script src="${resources_url}/plugins/sweetalert2/sweetalert2.min.js" type="text/javascript"></script>
    <!-- JqueryValidate -->
    <script src="https://cdn.jsdelivr.net/jquery.validation/1.14.0/jquery.validate.min.js" type="text/javascript"></script>    
    <!-- dbaxAdmin -->
    <script src="${resources_url}/plugins/dbaxadmin/dbaxadmin.js" type="text/javascript"></script>
    <!-- iCheck 1.0.1 -->
	<script src="${resources_url}/plugins/iCheck/icheck.min.js"></script>
      
	<script>
        //Submit jQuery Ajax Form 
        function SubmitForm(formId){        
            dbaxSubmitForm(formId).done(function(data) {
                //If no error              	
                if (data.cod_error === undefined){
                    if (formId ==='userSettingsForm'){
                      //Update Values
                      $('#profile_hash').val(data.profile_hash)
                      $('#profile_modified_by').val(data.profile_modified_by)
                      $('#profile_modified_date').val(data.profile_modified_date)
                    } else if (formId ==='userPasswordForm'){
                      $('#userPasswordForm')[0].reset();
                    }                  
                }
            });
        }
      
       $('input').iCheck({
          checkboxClass: 'icheckbox_square',
          radioClass: 'iradio_square',          
        });      

        $('#togglesidebar').on('ifChecked', function(event){
            $.post(  '${base_path}/users/${profile_username}/layout-options', { togglesidebar: "on"});
        });      
      
      	$('#togglesidebar').on('ifUnchecked', function(event){
            $.post(  '${base_path}/users/${profile_username}/layout-options', {togglesidebar: 'off'});
        });
  
    </script>
  
    </body>
</HTML>