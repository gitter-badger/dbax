<!-- Header -->
<?dbax dbax_core.include('header'); ?>
<!-- SideBar -->
<?dbax dbax_core.include('sidebar');?>
  
  <!-- Content Wrapper. Contains page content -->
      <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <section class="content-header">
          <h1>
            Dashboard            
          </h1>
          <ol class="breadcrumb">
            <li class="active"><i class="fa fa-dashboard"></i> Dashboard</li>
          </ol>
        </section>

        <!-- Main content -->
        <section class="content">
          <!-- Info boxes -->
          <div class="row">
            <div class="col-md-4 col-sm-6 col-xs-12">
              <div class="info-box">
                <span class="info-box-icon bg-aqua"><i class="fa fa-rocket"></i></span>
                <div class="info-box-content">
                  <span class="info-box-text">Applications</span>
                  <span class="info-box-number">${count_apps}</span>
                </div><!-- /.info-box-content -->
              </div><!-- /.info-box -->
            </div><!-- /.col -->
            <div class="col-md-4 col-sm-6 col-xs-12">
              <div class="info-box">
                <span class="info-box-icon bg-red"><i class="fa fa-eye"></i></span>
                <div class="info-box-content">
                  <span class="info-box-text">Views</span>
                  <span class="info-box-number">${count_views}</span>
                </div><!-- /.info-box-content -->
              </div><!-- /.info-box -->
            </div><!-- /.col -->

            <!-- fix for small devices only -->
            <div class="clearfix visible-sm-block"></div>

            <div class="col-md-4 col-sm-6 col-xs-12">
              <div class="info-box">
                <span class="info-box-icon bg-green"><i class="fa fa-road"></i></span>
                <div class="info-box-content">
                  <span class="info-box-text">Routes</span>
                  <span class="info-box-number">${count_routes}</span>
                </div><!-- /.info-box-content -->
              </div><!-- /.info-box -->
            </div><!-- /.col -->
            <div class="col-md-4 col-sm-6 col-xs-12">
              <div class="info-box">
                <span class="info-box-icon bg-yellow"><i class="ion ion-ios-people-outline"></i></span>
                <div class="info-box-content">
                  <span class="info-box-text">Users</span>
                  <span class="info-box-number">${count_users}</span>
                </div><!-- /.info-box-content -->
              </div><!-- /.info-box -->
            </div><!-- /.col -->
            <div class="col-md-4 col-sm-6 col-xs-12">
              <div class="info-box">
                <span class="info-box-icon bg-blue"><i class="ion ion-ios-time-outline"></i></span>
                <div class="info-box-content">
                  <span class="info-box-text">Sessions</span>
                  <span class="info-box-number">${count_sessions}</span>
                </div><!-- /.info-box-content -->
              </div><!-- /.info-box -->
            </div><!-- /.col -->
            <div class="col-md-4 col-sm-6 col-xs-12">
              <div class="info-box">
                <span class="info-box-icon bg-orange"><i class="ion ion-document-text"></i></span>
                <div class="info-box-content">
                  <span class="info-box-text">Logs</span>
                  <span class="info-box-number">${count_logs}</span>
                </div><!-- /.info-box-content -->
              </div><!-- /.info-box -->
            </div><!-- /.col -->            
          </div><!-- /.row -->

          <div class="row">
            <div class="col-md-12">
              <div class="box">
                <div class="box-header with-border">
                  <h3 class="box-title">Activity monitoring</h3>
                  
                </div><!-- /.box-header -->
                <div class="box-body">
                  <div class="row">
                    <div class="col-md-12">
                      <p class="text-center">
                        <strong>Activity in the last 8 hours</strong>
                      </p>
                      <div class="chart">
                        <!-- Sales Chart Canvas -->
                        <canvas id="activityChart" height="180"></canvas>                        
                      </div><!-- /.chart-responsive -->
                    </div><!-- /.col -->
                  
                  </div><!-- /.row -->
                </div><!-- ./box-body -->                
              </div><!-- /.box -->
            </div><!-- /.col -->
          </div><!-- /.row -->

          <!-- Main row -->
          <div class="row">
            <!-- Left col -->
            <div class="col-md-8">             
               <div class="box box-default">
                <div class="box-header with-border">
                  <h3 class="box-title">Latest Modifications</h3>
                </div><!-- /.box-header -->
                <div class="box-body">
                  <div class="table-responsive">
                    <table class="table no-margin">
                      <thead>
                        <tr>
                          <th>Description</th>
                          <th>Item</th>
                          <th>Appid</th>
                          <th>Modified By</th>
                          <th>Modified Date</th>
                        </tr>
                      </thead>
                      <tbody>
                        <?dbax 
                          for c1 in (select * from table (pk_m_dbax_console.latest_modifications))
                          loop
                            p('<tr>');
                              p('<td>'|| c1.description ||'</td>');
                              p('<td>'|| c1.name ||'</td>');
                              p('<td>'|| c1.appid ||'</td>');
                              p('<td>'|| c1.modified_by ||'</td>');
                              p('<td>'|| to_char(c1.modified_date,'yyyy-mm-dd hh24:mi:ss') ||'</td>');
                            p('</tr>');
                          end loop;
						?>                        
                      </tbody>
                    </table>
                  </div><!-- /.table-responsive -->
                </div><!-- /.box-body -->                
              </div><!-- /.box -->
            </div><!-- /.col -->

            <div class="col-md-4">
             
              <div class="box box-default">
                <div class="box-header with-border">
                  <h3 class="box-title">Browser Usage in the last 8 hours</h3>
                </div><!-- /.box-header -->
                <div class="box-body">
                  <div class="row">
                    <div class="col-md-8">
                      <div class="chart-responsive">
                        <canvas id="pieChart" height="150"></canvas>
                      </div><!-- ./chart-responsive -->
                    </div><!-- /.col -->
                    <div class="col-md-4">
                      <ul class="chart-legend clearfix">
                        <li><i class="fa fa-circle-o text-red"></i> Chrome</li>
                        <li><i class="fa fa-circle-o text-green"></i> IE</li>
                        <li><i class="fa fa-circle-o text-yellow"></i> FireFox</li>
                        <li><i class="fa fa-circle-o text-aqua"></i> Safari</li>
                        <li><i class="fa fa-circle-o text-light-blue"></i> Other</li>                        
                      </ul>
                    </div><!-- /.col -->
                  </div><!-- /.row -->
                </div><!-- /.box-body -->                
              </div><!-- /.box -->

              
            </div><!-- /.col -->
          </div><!-- /.row -->
        </section><!-- /.content -->
      </div><!-- /.content-wrapper -->   
   
  
   <?dbax dbax_core.include('footer'); ?>

    <!-- ChartJS 1.0.1 -->
    <script src="${resources_url}/plugins/chartjs/Chart.min.js" type="text/javascript"></script>


<script>
  //-----------------------
  //-Activity CHART -
  //-----------------------

  // Get context with jQuery - using jQuery's .get() method.
  var activityChartCanvas = $("#activityChart").get(0).getContext("2d");
  // This will get the first returned node in the jQuery collection.
  var activityChart = new Chart(activityChartCanvas);

  var activityChartData = {
    labels: ${activityChartTimes},
    datasets: [
      {
        label: "Digital Goods",
        fillColor: "rgba(60,141,188,0.9)",
        strokeColor: "rgba(60,141,188,0.8)",
        pointColor: "#3b8bba",
        pointStrokeColor: "rgba(60,141,188,1)",
        pointHighlightFill: "#fff",
        pointHighlightStroke: "rgba(60,141,188,1)",
        data: ${activityChartData}
      }
    ]
  };

  var activityChartOptions = {
    //Boolean - If we should show the scale at all
    showScale: true,
    //Boolean - Whether grid lines are shown across the chart
    scaleShowGridLines: false,
    //String - Colour of the grid lines
    scaleGridLineColor: "rgba(0,0,0,.05)",
    //Number - Width of the grid lines
    scaleGridLineWidth: 1,
    //Boolean - Whether to show horizontal lines (except X axis)
    scaleShowHorizontalLines: true,
    //Boolean - Whether to show vertical lines (except Y axis)
    scaleShowVerticalLines: true,
    //Boolean - Whether the line is curved between points
    bezierCurve: true,
    //Number - Tension of the bezier curve between points
    bezierCurveTension: 0.3,
    //Boolean - Whether to show a dot for each point
    pointDot: false,
    //Number - Radius of each point dot in pixels
    pointDotRadius: 4,
    //Number - Pixel width of point dot stroke
    pointDotStrokeWidth: 1,
    //Number - amount extra to add to the radius to cater for hit detection outside the drawn point
    pointHitDetectionRadius: 20,
    //Boolean - Whether to show a stroke for datasets
    datasetStroke: true,
    //Number - Pixel width of dataset stroke
    datasetStrokeWidth: 2,
    //Boolean - Whether to fill the dataset with a color
    datasetFill: true,
    //String - A legend template
    //legendTemplate: "<ul class=\"<%=name.toLowerCase()%>-legend\"><% for (var i=0; i<datasets.length; i++){%><li><span style=\"background-color:<%=datasets[i].lineColor%>\"></span><%=datasets[i].label%></li><%}%></ul>",
    //Boolean - whether to maintain the starting aspect ratio or not when responsive, if set to false, will take up entire container
    maintainAspectRatio: false,
    //Boolean - whether to make the chart responsive to window resizing
    responsive: true,
    //String - A tooltip template
    tooltipTemplate: "<%=value %> hits at <%=label%>"
  };

  //Create the line chart
  activityChart.Line(activityChartData, activityChartOptions);

  //---------------------------
  //- END Activity CHART -
  //---------------------------
  
  
  //-------------
  //- PIE CHART -
  //-------------
  // Get context with jQuery - using jQuery's .get() method.
  var pieChartCanvas = $("#pieChart").get(0).getContext("2d");
  var pieChart = new Chart(pieChartCanvas);
  var pieValues = [${pieChartValues}];
  var PieData = [
    {
      value: pieValues[0][0][0],
      color: "#f56954",
      highlight: "#f56954",
      label: "Chrome"
    },
    {
      value: pieValues[0][1][0],
      color: "#00a65a",
      highlight: "#00a65a",
      label: "IE"
    },
    {
      value: pieValues[0][2][0],
      color: "#f39c12",
      highlight: "#f39c12",
      label: "FireFox"
    },
    {
      value: pieValues[0][3][0],
      color: "#00c0ef",
      highlight: "#00c0ef",
      label: "Safari"
    },
    {
      value: pieValues[0][4][0],
      color: "#3c8dbc",
      highlight: "#3c8dbc",
      label: "Other"
    }
  ];
  var pieOptions = {
    //Boolean - Whether we should show a stroke on each segment
    segmentShowStroke: true,
    //String - The colour of each segment stroke
    segmentStrokeColor: "#fff",
    //Number - The width of each segment stroke
    segmentStrokeWidth: 1,
    //Number - The percentage of the chart that we cut out of the middle
    percentageInnerCutout: 50, // This is 0 for Pie charts
    //Number - Amount of animation steps
    animationSteps: 100,
    //String - Animation easing effect
    animationEasing: "easeOutBounce",
    //Boolean - Whether we animate the rotation of the Doughnut
    animateRotate: true,
    //Boolean - Whether we animate scaling the Doughnut from the centre
    animateScale: false,
    //Boolean - whether to make the chart responsive to window resizing
    responsive: true,
    // Boolean - whether to maintain the starting aspect ratio or not when responsive, if set to false, will take up entire container
    maintainAspectRatio: false,
    //String - A legend template
    legendTemplate: "<ul class=\"<%=name.toLowerCase()%>-legend\"><% for (var i=0; i<segments.length; i++){%><li><span style=\"background-color:<%=segments[i].fillColor%>\"></span><%if(segments[i].label){%><%=segments[i].label%><%}%></li><%}%></ul>",
    //String - A tooltip template
    tooltipTemplate: "<%=value %> <%=label%>"
  };
  //Create pie or douhnut chart
  // You can switch between pie and douhnut using the method below.  
  pieChart.Doughnut(PieData, pieOptions);
  //-----------------
  //- END PIE CHART -
  //-----------------
  
</script>


</body>
</HTML>